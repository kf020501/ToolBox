# 必要なURLを指定します
$url = "https://www.oracle.com/security-alerts/cpuoct2024verbose.html"

# HTMLを取得
$response = Invoke-WebRequest -Uri $url

# HTMLを解析してノードを抽出
$html = $response.ParsedHtml

# "Text Form of Risk Matrix for Oracle Database Server" の h3 ヘッダーを検索
$table = $html.getElementsByTagName("h3") | Where-Object { $_.id -eq "DB" } `
           | ForEach-Object { $_.nextSibling.nextSibling.getElementsByTagName("table") } `
           | Select-Object -First 1

# テーブルデータを抽出
$rows = $table.rows

# CSV出力用配列
$data = @()

# テーブルヘッダーを追加
$headers = @()
foreach ($cell in $rows[0].cells) {
    $headers += $cell.innerText
}
$data += $headers -join ","

# テーブル行データを追加
for ($i = 1; $i -lt $rows.length; $i++) {
    $row = $rows[$i]
    $cells = @()
    foreach ($cell in $row.cells) {
        # 各セルの値を抽出
        $cells += $cell.innerText -replace "`n|`r", "" # 改行を削除
    }
    $data += $cells -join ","
}

# CSV形式で出力
$outputPath = "output.csv"
$data | Out-File -FilePath $outputPath -Encoding UTF8

Write-Output "CSV file exported to: $outputPath"
